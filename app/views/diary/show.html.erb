<%= stylesheet_link_tag "diary" %>

<h1 class="main-title">日記</h1>

<!--通知・エラー-->
<div>
  <% flash.each do |key, value| %>
    <div class="alert alert-<%= key %>"><%= value %></div>
  <% end %>
</div>

<div>
  <% if @diary_good.errors.any? %>
    <div id="error_explanation" class="alert alert-danger">
      <ul>
        <% @diary_good.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
<!--  通知・エラー-->

<div class="wrapper">
  <div class="row my-row">
    <div class="col-md-9 left-col">
      <% @diary_user.each do |diary_user| %>
        <!--        card-->
        <div class="card diary-card">
          <div class="card-header diary-card-header">
            <%= image_tag "#{diary_user.avatar_path}", class: "img-circle", size: "43x43" %>
            <%= diary_user.name %>
          </div>
          <!--          body-->
          <div class="card-body diary-card-body">
            <div class="diary-time">
              <%= diary_user.post_time %>
            </div>
            <div class="diary-content">
              <%= simple_format(diary_user.content) %>
            </div>
          </div>
          <!--          body-->
          <!-- カードフッター -->
          <div class="card-footer diary-card-footer">
            <div class="card-footer-btn">
              <div class="good_user_box">
                <!-- いいねユーザアイコン -->
                <% @good_avatar.each_with_index do |good_avatar, i| %>
                  <% if diary_user.diaries_id == good_avatar.diary_id %>
                    <%= image_tag "#{good_avatar.avatar_path}", class: "img-circle", size: "30x30" %>
                  <% end %>
                <% end %>
              </div>
              <!-- いいねボタン -->
              <%= form_for @diary_good, url: "/diary/show/#{diary_user.diaries_id}/good", remote: true do |f| %>
                <%= f.button type: "submit", method: "post", class: "btn icon-btn" do %>
                  <%= fa_icon "thumbs-up", class:"icon-color" %>
                  <% if @good[diary_user.diaries_id] == nil %>
                    <%= 0 %>
                  <% else %>
                    <span id="js-good"><%= @good[diary_user.diaries_id] %></span>
                  <% end %>
                <% end %>
              <% end %>
              <!-- コメントボタン -->
              <button class="btn good-and-comment icon-btn" data-toggle="collapse" data-target="#<%= diary_user.diaries_id %>">
                <%= fa_icon "comment", class: "icon-color" %>
                <% if @comment_count[diary_user.diaries_id] == nil %>
                  <span>0</span>
                <% else %>
                  <%= @comment_count[diary_user.diaries_id] %>
                <% end %>
              </button>
              <!-- 削除ボタン -->
              <% if diary_user.user_id == session[:id] %>
                <%= form_for @diary_good, url: "/diary/post/#{diary_user.diaries_id}/delete" do |f| %>
                  <%= f.button type: "submit", remote: "true", method: "post", class: "btn btn-default icon-btn" do %>
                    <%= fa_icon "trash", class: "icon-color"%>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <!-- コメント詳細 -->
            <div class="collapse" id="<%= diary_user.diaries_id %>">
              <% @comment.each do |comment| %>
                <% if comment.diary_id == diary_user.diaries_id %>
                  <div class="panel panel-default">
                    <div class="panel-title">
                      <h5>
                        <%= image_tag "#{comment.avatar_path}", class: "img-circle", size: "25x25" %>
                        <%= comment.name %>
                      </h5>
                    </div>
                    <div class="panel-body comment-body">
                      <p>
                        <%= comment.comment %>
                      </p>
                    </div>
                    <div class="panel-footer panel-time">
                      <%= comment.post_time %>
                    </div>
                  </div>
                <% end %>
              <% end %>
              <div>
                <h3>
                  <%= image_tag "#{@user.avatar_path}", class: "img-circle", size: "30x30"  %>
                  <%= @user.name %>
                </h3>
              </div>
              <div>
                <%= form_for @diary_comment, url: "/diary/show/#{diary_user.diaries_id}/comment", remote: "true" do |f| %>
                  <%= f.text_area :comment, class:"form-control", size: "200x5", placeholder: "100文字以内" %>
                  <div class="comment-btn">
                    <%= f.submit "コメント", class: "btn btn-default" %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
<!--  right-->
    <div class="col-md-3 right-col">
      <div class="in-box">
        <div class="card diary-post-card">
          <div class="diary-post-card-header">
            <%= image_tag "#{@user.avatar_path}", class: "img-circle", size: "60x60" %>
            <%= @user.name %>
          </div>
          <%= form_for @diary, url: "/diary/post" do |f| %>
            <div class="diary-post-card-body">
              <div>
                <%= f.text_area :content, class: "form-control", placeholder: "文章など", size: "10x10" %>
              </div>
            </div>
            <div class="diary-post-card-footer post-btn">
              <%= f.submit "投稿", class: "btn btn-lg my-btn" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>